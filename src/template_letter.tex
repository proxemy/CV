\documentclass[a4paper,fontsize=12]{letter}

\usepackage[utf8]{inputenc}     % UTF-8 instead of ASCII
\usepackage[iso,ngerman]{isodate}
\usepackage{scrlayer-scrpage}
\usepackage[dvipsnames,table]{xcolor}
\usepackage{graphicx,hyperref,geometry,tabularx,xstring}

% set link colors
\hypersetup{colorlinks=true, urlcolor=blue, linkcolor=black,}

% helper macros
\newcommand{\HrefEmail}[1]{\href{mailto:#1}{#1}}
\newcommand{\HrefUrl}[1]{\href{https://#1}{#1}}
\newcommand{\PrettyDate}{\number\day{}.\number\month{}.\number\year}
\newcommand{\IfNonEmpty}[2]{\ifthenelse{\equal{#1}{}}{}{#2}}
\newcommand{\BlueHLine}{\arrayrulecolor{RoyalBlue}\hline}
\newcommand{\I}[3]{#1 – #2 & #3 \\} % adds CV rows


% text generators
\newcommand{\MySignature}{%
	\parbox{\linewidth}{%
	\bigskip\hspace*{0.6cm}\raisebox{-0.4cm}[1.5cm][0cm]{%
		\includegraphics[height=2cm]{\CVDataPath/Signature.png}\\
	}\\
	\MyCity{}, \PrettyDate \\
	\MyNameFirst{} \MyNameLast
}}

\newif\ifRecpIsMale
\IfSubStr{\RecpTitle}{Herr}{ \RecpIsMaletrue }{ \RecpIsMalefalse }
\def\RecpSalutation{%
	\IfNonEmpty{\RecpCompany}{%
		Sehr geehrte Damen und Herren \RecpCompanySalutForm{},
		\IfNonEmpty{\RecpName}{\newline}
	}
		\IfNonEmpty{\RecpName}{%
		Sehr geehrte\ifRecpIsMale r \fi \RecpTitle{} \RecpName,
	}
}%

\newcommand{\MyAddr}{%
	\MyNameFirst{} \MyNameSur{} \MyNameLast{}\\
	\MyStreet\\
	\MyCityCode{} \MyCity\\
}

\newcommand{\MyContact}{%
	\IfNonEmpty{\MyTelLandline}{Festnetz & \MyTelLandline \\}
	\IfNonEmpty{\MyTelMobile}{Mobil & \MyTelMobile \\}
	\IfNonEmpty{\MyTelFax}{Fax & \MyTelFax \\}
	\IfNonEmpty{\MySite}{Webiste & \MySite \\}
	\IfNonEmpty{\MyEmail}{Email & \MyEmail \\}
}

\newcommand{\MyState}{%
	\IfNonEmpty{\MyFamilyState}{Familienstand & \MyFamilyState \\}
	\IfNonEmpty{\MyReligion}{Religion & \MyReligion \\}
}

\newcommand{\PrintMyExtData}[1]{%
	\parbox{#1}{\strut
		\MyAddr
		\newline
		{\begin{tabularx}{\linewidth}{@{}rX@{}}
			\MyState
			\MyContact
		\end{tabularx}}
	\strut}
}

\newcommand{\PrintMyData}[1]{%
	\parbox{#1}{\strut
		\MyAddr
		\newline
		{\begin{tabularx}{\linewidth}{@{}rX@{}}
			\MyContact
		\end{tabularx}}	
	\strut}
}

\begin{document}

%\pagestyle{plain}
%\pagenumbering{gobble} % disable page enumeration

% recipient letter head
\begin{minipage}[t][4cm][b]{11cm}
	\RecpCompany\\
	\IfNonEmpty{\RecpName}{ \RecpTitle \ \RecpName \\}
	\RecpStreet\\
	\RecpCity\\
	\RecpEmail
\end{minipage}%
% sender
\begin{minipage}[t][0cm][b]{\linewidth}\begin{flushright}
	\PrintMyData{\linewidth}
\end{flushright}\end{minipage}

\setlength{\parskip}{1ex}

% location, date
\begin{flushright}\bigskip{}\MyCity{}, \PrettyDate{}\end{flushright}


% subject
\bigskip\textbf{\MyTitle{} \IfNonEmpty{\RecpJobRef}{\\ Referenz: \RecpJobRef}}


%salutation
\bigskip\bigskip
\RecpSalutation
\medskip

\RecpCoverLetter

\vfill
Mit freundlichen Grüßen

\MySignature
\vfill\vfill\vfill

% title page and toc
\newpage

\end{document}
